name: C/C++ format

on:
  push:
    branches: [main]
  pull_request:
    # Check all PR

jobs:
  # check C/C++ formatting
  cpp-format:
    runs-on: ubuntu-latest
    name: check C/C++ formatting
      steps:
      - uses: actions/checkout@v3
      - run: |
          sudo apt-get install clang-format
          if ! git diff --exit-code --name-only origin/master...HEAD | grep -E '\.(c|cpp|h|hpp)$'; then
            exit 0
          fi

          for file in $(git diff --name-only origin/master...HEAD | grep -E '\.(c|cpp|h|hpp)$'); do
            clang-format -style=file -i "$file"
            if git diff --quiet "$file"; then
              echo "✅ $file is properly formatted."
            else
              echo "❌ $file is not properly formatted. Please run clang-format with `find . -name "*.c" -o -name "*.h" -o -name "*.cpp" -o -name "*.hpp" | xargs clang-format -i`."
              exit 1
            fi
          done
